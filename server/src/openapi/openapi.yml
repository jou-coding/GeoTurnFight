openapi: 3.0.3
info:
  title: Room API
  version: 0.1.0
servers:
  - url: http://localhost:3000/api/room

paths:
  /getRoomId:
    get:
      summary: ルームIDを取得する
      tags: ["Room"]
      description: クエリ `name` を受け取り、対応するルームIDを返す。
      parameters:
        - name: name
          in: query
          required: true
          schema:
            type: string
          description: ルーム名
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetRoomIdResponse'
              examples:
                sample:
                  value:
                    id: "r_123"
        '500':
          description: サーバーエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error500'
              examples:
                sample:
                  value:
                    status: false
                    error: "サーバーエラーが発生しました"

  /createRoom:
    post:
      tags: ["Room"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: ""
              required:
                - name
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetRoomIdResponse"
              examples:
                sample:
                  value:
                    status: true
        "400":
          description: bodyに値が入っていない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error400"
              examples:
                sample:
                  value:
                    status: false
                    error: "不正なリクエストです"
        409:
          description: ルーム名の重複禁止です。
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error400"
              examples:
                sample:
                  value:
                    status: false
                    error: "不正なリクエストです"

        "500":
          description: サーバーエラー
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error500"
              examples:
                sample:
                  value:
                    status: false
                    error: "サーバーエラーが発生しました"

  /allRooms:
    get:
      summary: すべての部屋を取得する
      tags: ["Room"]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetRoomIdResponse'
              examples:
                sample:
                  value:
                    id: "r_123"
        '500':
          description: サーバーエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error500'
              examples:
                sample:
                  value:
                    status: false
                    error: "サーバーエラーが発生しました"

  /findRoom:
    post:
      summary: ルームを検索する
      tags: ["Room"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: ""
              required:
                - name
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetRoomIdResponse"
              examples:
                sample:
                  value:
                    room: "roomA"
        "400":
          description: 値が入っていない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error400"
              examples:
                sample:
                  value:
                    status: false
                    error: "不正なリクエストです"
        "404":
          description: ルームが存在しない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error400"
              examples:
                sample:
                  value:
                    status: false
                    error: "ルームが存在しない"
        '500':
          description: サーバーエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error500'
              examples:
                sample:
                  value:
                    status: false
                    error: "サーバーエラーが発生しました"
  /register:
    post:
      summary: 新規登録
      tags: ["Auth"]
      description: ユーザーを新規登録します。
      requestBody:
        description: 新規登録の内容
        required: true
        content:
          application/json:
            schema:
              type: object
              properties: 
                username: {type: string,example: ユーザーネーム}
                password: {type: string,example: パスワード}
      responses:
        "201":
          description: "新規登録成功"
        "400":
          description: 入力不足
        "409":
          description: 既に存在するユーザー
        "500":
          description: サーバー内部エラー
  /login:
    post:
      summary: ログイン
      tags: ["Auth"]
      description: ユーザー認証に成功した場合、JWTを発行する。
      requestBody:
        description: ログインするための情報
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username: {type: string,example: ユーザーネーム}
                password: {type: string,example: パスワード}
      responses:
        200:
          description: ok
        "400":
          description: 入力不足
        "401":
          description: 認証失敗
        "500":
          description: サーバー内部エラー
  /refresh:
    post:
      summary: トークン更新（アクセストークン再発行）
      tags: ["Auth"]
      description: リフレッシュトークンを使ってアクセストークンを再発行します。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken: {type: string,example: rt_9f3a2c8b1e6d34abcde}
      responses:
        "200":
          description: "成功レスポンス"
        "401":
          description: リフレッシュトークン無効/期限切れ
        "500":
          description: サーバー内部エラー

  /logout:
    post:
      summary: ログアウト（リフレッシュトークン無効化）
      tags: ["Auth"]
      description: リフレッシュトークンを無効化しログアウトします。
      requestBody:
        required: true
        content: 
          application/json:
            schema:
              type: object
              properties:
                  refreshToken: {type: string,example: rt_9f3a2c8b1e6d34abcde}
      responses:
          "200":
            description: "成功レスポンス"
          "401":
            description: トークン無効
          "500":
            description: サーバー内部エラー
  
  


components:
  schemas:
    GetRoomIdResponse:
      type: object
      required: [id]
      properties:
        id:
          type: string
          description: ルームID
    Error500:
      type: object
      required: [status, error]
      properties:
        status:
          type: boolean
          example: false
        error:
          type: string
          example: "サーバーエラーが発生しました"
    Error400:
      type: object
      required: [status, error]
      properties:
        status:
          type: boolean
          example: false
        error:
          type: string
          example: "不正なリクエストです"
